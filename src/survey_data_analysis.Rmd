---
title: "KelpWanted- Survey Data Analysis"
author: "Sydney Rilum"
date: "12/15/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
# Load necessary packages
library(tidyverse)
library(here)
library(janitor)
library(sf)          # read in shapefiles
library(tmap)        # interactive maps
library(ggwordcloud) # create wordcloud plots
library(patchwork)   # for stacking plots
```

## Data Set-up & Cleaning

```{r}
# Read in combined survey data
survey_data <- read.csv(here("data","survey_data","combined_survey_responses.csv"))

# Read in the Qualtrics Survey data
survey_data_qualtrics <- read.csv(here("data","survey_data","qualtrics_survey_responses_final.csv"))

# Read in the QR code Survey data
survey_data_qrcode <- read.csv(here("data","survey_data","QRcode_choice_text_January13,2022.csv"))

```

```{r}
# Clean up dataframes
survey_data_tidy <- survey_data %>%
  clean_names() %>% 
  slice(-1) # remove first row of df

survey_data_qualtrics_tidy <- survey_data_qualtrics %>%
  clean_names() %>% 
  slice(-1) # remove first row of df

survey_data_qrcode_tidy <- survey_data_qrcode %>%
  clean_names() %>% 
  slice(-(1:2)) %>% # remove first 2 rows of df
  select(-recipient_last_name, # remove empty/unnecessary columns
         -recipient_first_name,
         -recipient_email,
         -external_reference,
         -distribution_channel,
         -user_language,
         -status)
```

```{r}
# Check class
class(survey_data_tidy$duration_in_seconds) # character

# Convert class from character to numeric
survey_data_tidy$duration_in_seconds = as.numeric(survey_data_tidy$duration_in_seconds)

# Calculate average time (seconds) spent taking survey
mean(survey_data_tidy$duration_in_seconds)

```

## Zipcode Analysis

```{r}
# q37 - Zipcode
unique(survey_data_tidy$q37)

# remove non-CA zipcode responses


# Make a map of survey response zipcodes


```


```{r}
# Read in California counties outline
ca_counties <- read_sf(here("data", "ca_counties", "CA_Counties_TIGER2016.shp")) %>% 
  clean_names()

# Read in US zipcodes tabulation areas
us_zipcodes <- read_sf(here("data", "zipcode_tabulation_areas_2020", "tl_2021_us_zcta520.shp")) %>% 
  clean_names()

```

```{r}
us_zipcodes <- drop_na(us_zipcodes)

# Check class
class(us_zipcodes$ztca5ce20) # character
```


```{r}
# Crop US zipcodes data frame to include only CA zipcodes
#ca_zipcodes <- us_zipcodes %>% 
#  filter(ztca5ce20 > 90000,
#         ztca5ce20 < 95000)
```


```{r}
# Check CRS (Coordinate Reference System)
st_crs(ca_counties) # WGS 84
st_crs(us_zipcodes) # NA
```


```{r}
# Set tmap viewing mode to interactive
#tmap_mode("view") 

# Make an interactive map
#tm_shape(ca_zipcodes) +
#  tm_borders()
#  tm_shape(oil_spill) +
#  tm_dots(col = "sienna2")
```


## Word Clouds

```{r}
# Word Cloud data cleaning

# convert each string of words to lowercase
survey_data_tidy$q3 <- tolower(survey_data_tidy$q3)  # seaweed farming
survey_data_tidy$q5 <- tolower(survey_data_tidy$q5)  # kelp farming
survey_data_tidy$q7 <- tolower(survey_data_tidy$q7)  # seaweed aquaculture
survey_data_tidy$q9 <- tolower(survey_data_tidy$q9)  # seaweed farming
```

```{r}
# q3 - seaweed farming
seaweed_farming <- survey_data_tidy %>% 
  select(q3) %>%
  mutate(q3 = str_trim(q3)) %>%  # remove excess whitespace before/after word
  count(q3) %>%                  # count repeating words
  arrange(-n)                    # arrange word counts from largest to smallest


wordcloud_seaweed_farming <- ggplot(data = seaweed_farming, 
                                    aes(label = q3)) +
  geom_text_wordcloud(aes(color = n, size = n), 
                      shape = "diamond") +
  scale_size_area(max_size = 25) +
  scale_color_gradientn(colors = c("burlywood4", "green")) +
  theme_minimal() +
  labs(y = "seaweed") +
  theme(axis.line.y = element_line(color="black", size = 0.1))
```

```{r}
# q5 - kelp farming
kelp_farming <- survey_data_tidy %>% 
  select(q5) %>%
  mutate(q5 = str_trim(q5)) %>%  # remove excess whitespace before/after word
  count(q5) %>%                  # count repeating words
  arrange(-n)                    # arrange word counts from largest to smallest


wordcloud_kelp_farming <- ggplot(data = kelp_farming, 
                                    aes(label = q5)) +
  geom_text_wordcloud(aes(color = n, size = n), 
                      shape = "diamond") +
  scale_size_area(max_size = 25) +
  scale_color_gradientn(colors = c("darkgreen", "green")) +
  theme_minimal() +
  labs(y = "kelp",
       x = "farming") +
  theme(axis.line.x = element_line(color="black", size = 0.1),
        axis.line.y = element_line(color="black", size = 0.1))
```

```{r}
# q7 - seaweed aquaculture
seaweed_aquaculture <- survey_data_tidy %>% 
  select(q7) %>%
  mutate(q7 = str_trim(q7)) %>%  # remove excess whitespace before/after word
  count(q7) %>%                  # count repeating words
  arrange(-n)                    # arrange word counts from largest to smallest


wordcloud_seaweed_aquaculture <- ggplot(data = seaweed_aquaculture, 
                                    aes(label = q7)) +
  geom_text_wordcloud(aes(color = n, size = n), 
                      shape = "diamond") +
  scale_size_area(max_size = 25) +
  scale_color_gradientn(colors = c("springgreen4", "green")) +
  theme_minimal()
```

```{r}
# q9 - kelp aquaculture
kelp_aquaculture <- survey_data_tidy %>% 
  select(q9) %>%
  mutate(q9 = str_trim(q9)) %>%  # remove excess whitespace before/after word
  count(q9) %>%                  # count repeating words
  arrange(-n)                    # arrange word counts from largest to smallest


wordcloud_kelp_aquaculture <- ggplot(data = kelp_aquaculture, 
                                    aes(label = q9)) +
  geom_text_wordcloud(aes(color = n, size = n), 
                      shape = "diamond") +
  scale_size_area(max_size = 25) +
  scale_color_gradientn(colors = c("yellow4", "green")) +
  theme_minimal() +
  labs(x = "aquaculture") +
  theme(axis.line.x = element_line(color="black", size = 0.1))
```

```{r}
# stack word cloud plots using `patchwork` 
wordclouds <- ((wordcloud_seaweed_farming + wordcloud_seaweed_aquaculture) /
                 (wordcloud_kelp_farming + wordcloud_kelp_aquaculture))

wordclouds +
  plot_annotation(title = "When you think of _____  _____, what word comes to mind?") &
  theme(plot.title = element_text(size = 12))

```

## Demographics

```{r}
## Exploratory Plots

# Birth Year (Q31)
ggplot(data = survey_data_tidy, aes(y = q31)) +
  geom_bar()
### need to remove SB and NJ words from years

# Gender Identity (Q32)
ggplot(data = survey_data_tidy, aes(x = q32)) +
  geom_bar()

# Race/ethnicity (Q33)
ggplot(data = survey_data_tidy, aes(y = q33)) +
  geom_bar()
### how to deal with people selecting more than one option ????

# Highest level of education (Q34)
ggplot(data = survey_data_tidy, aes(y = q34)) +
  geom_bar()

# Annual household income (Q35)
ggplot(data = survey_data_tidy, aes(y = q35)) +
  geom_bar()

# Political Affiliation (Q38)
ggplot(data = survey_data_tidy, aes(y = q38)) +
  geom_bar()


```


## Citations:

California county boundaries layer: [US Census Bureau's 2016 MAF/TIGER database.](https://data.ca.gov/dataset/ca-geographic-boundaries)

California ZIP code tabulations areas layer: [US Census Bureau's 2020 TIGER/Line Shapefiles database.](https://www.census.gov/cgi-bin/geo/shapefiles/index.php?year=2021&layergroup=ZIP+Code+Tabulation+Areas)



